
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>src.environment &#8212; salomeTools 5.0.0dev documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for src.environment</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#-*- coding:utf-8 -*-</span>
<span class="c1">#  Copyright (C) 2010-2013  CEA/DEN</span>
<span class="c1">#</span>
<span class="c1">#  This library is free software; you can redistribute it and/or</span>
<span class="c1">#  modify it under the terms of the GNU Lesser General Public</span>
<span class="c1">#  License as published by the Free Software Foundation; either</span>
<span class="c1">#  version 2.1 of the License.</span>
<span class="c1">#</span>
<span class="c1">#  This library is distributed in the hope that it will be useful,</span>
<span class="c1">#  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="c1">#  Lesser General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#  You should have received a copy of the GNU Lesser General Public</span>
<span class="c1">#  License along with this library; if not, write to the Free Software</span>
<span class="c1">#  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">src</span>
<span class="kn">import</span> <span class="nn">src.debug</span> <span class="k">as</span> <span class="nn">DBG</span>
<span class="kn">import</span> <span class="nn">pprint</span> <span class="k">as</span> <span class="nn">PP</span>

<div class="viewcode-block" id="Environ"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ">[docs]</a><span class="k">class</span> <span class="nc">Environ</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Class to manage the environment context</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization. If the environ argument is passed, the environment</span>
<span class="sd">           will be add to it, else it is the external environment.</span>
<span class="sd">           </span>
<span class="sd">        :param environ dict:  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">environ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;easy non exhaustive quick resume for debug print&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">PP</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_expandvars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        replace some $VARIABLE into its actual value in the environment</span>
<span class="sd">        </span>
<span class="sd">        :param value str: the string to be replaced</span>
<span class="sd">        :return: the replaced variable</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;$&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="c1"># The string.Template class is a string class </span>
            <span class="c1"># for supporting $-substitutions</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">zt</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">src</span><span class="o">.</span><span class="n">SatException</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Missing definition &quot;</span>
                                         <span class="s2">&quot;in environment: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="Environ.append_value"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.append_value">[docs]</a>    <span class="k">def</span> <span class="nf">append_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        append value to key using sep</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to append</span>
<span class="sd">        :param value str: the value to append to key</span>
<span class="sd">        :param sep str: the separator string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if the key is already in the environment</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">value_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
            <span class="c1"># Check if the value is already in the key value or not</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
                <span class="n">value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">value_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value_list</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Environ.append"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Same as append_value but the value argument can be a list</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to append</span>
<span class="sd">        :param value str or list: the value(s) to append to key</span>
<span class="sd">        :param sep str: the separator string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span></div>

<div class="viewcode-block" id="Environ.prepend_value"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.prepend_value">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        prepend value to key using sep</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to prepend</span>
<span class="sd">        :param value str: the value to prepend to key</span>
<span class="sd">        :param sep str: the separator string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="n">value_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
                <span class="n">value_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">value_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">value_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value_list</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Environ.prepend"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.prepend">[docs]</a>    <span class="k">def</span> <span class="nf">prepend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Same as prepend_value but the value argument can be a list</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to prepend</span>
<span class="sd">        :param value str or list: the value(s) to prepend to key</span>
<span class="sd">        :param sep str: the separator string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepend_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepend_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span></div>

<div class="viewcode-block" id="Environ.is_defined"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.is_defined">[docs]</a>    <span class="k">def</span> <span class="nf">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Check if the key exists in the environment</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="Environ.set"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Set the environment variable &quot;key&quot; to value &quot;value&quot;</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to set</span>
<span class="sd">        :param value str: the value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expandvars</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Environ.get"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Get the value of the environment variable &quot;key&quot;</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>

<div class="viewcode-block" id="Environ.command_value"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Environ.command_value">[docs]</a>    <span class="k">def</span> <span class="nf">command_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Get the value given by the system command &quot;command&quot; </span>
<span class="sd">        and put it in the environment variable key</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable</span>
<span class="sd">        :param command str: the command to execute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span>
                                 <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                 <span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="SalomeEnviron"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron">[docs]</a><span class="k">class</span> <span class="nc">SalomeEnviron</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Class to manage the environment of SALOME.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">cfg</span><span class="p">,</span>
                 <span class="n">environ</span><span class="p">,</span>
                 <span class="n">forBuild</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">for_package</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">enable_simple_env_script</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Initialization.</span>

<span class="sd">        :param cfg Config: the global config</span>
<span class="sd">        :param environ Environ: the Environ instance where </span>
<span class="sd">                                to store the environment variables</span>
<span class="sd">        :param forBuild bool: If true, it is a launch environment, </span>
<span class="sd">                              else a build one</span>
<span class="sd">        :param for_package str: If not None, produce a relative environment </span>
<span class="sd">                                designed for a package. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span> <span class="o">=</span> <span class="n">forBuild</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span> <span class="o">=</span> <span class="n">for_package</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_simple_env_script</span> <span class="o">=</span> <span class="n">enable_simple_env_script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;easy almost exhaustive quick resume for debug print&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;environ&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
          <span class="s2">&quot;forBuild&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span><span class="p">,</span>
          <span class="s2">&quot;for_package&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">PP</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>

<div class="viewcode-block" id="SalomeEnviron.append"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        append value to key using sep</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to append</span>
<span class="sd">        :param value str: the value to append to key</span>
<span class="sd">        :param sep str: the separator string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.prepend"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.prepend">[docs]</a>    <span class="k">def</span> <span class="nf">prepend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        prepend value to key using sep</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to prepend</span>
<span class="sd">        :param value str: the value to prepend to key</span>
<span class="sd">        :param sep str: the separator string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.is_defined"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.is_defined">[docs]</a>    <span class="k">def</span> <span class="nf">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Check if the key exists in the environment</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.get"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Get the value of the environment variable &quot;key&quot;</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.set"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Set the environment variable &quot;key&quot; to value &quot;value&quot;</span>
<span class="sd">        </span>
<span class="sd">        :param key str: the environment variable to set</span>
<span class="sd">        :param value str: the value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if value needs to be evaluated</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;`&quot;</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s2">&quot;echo </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">,</span>
                                   <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.dump"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Write the environment to out</span>
<span class="sd">        </span>
<span class="sd">        :param out file: the stream where to write the environment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="SalomeEnviron.add_line"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.add_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Add empty lines to the out stream (in case of file generation)</span>
<span class="sd">        </span>
<span class="sd">        :param nb_line int: the number of empty lines to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;add_line&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">nb_line</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.add_comment"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.add_comment">[docs]</a>    <span class="k">def</span> <span class="nf">add_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Add a commentary to the out stream (in case of file generation)</span>
<span class="sd">        </span>
<span class="sd">        :param comment str: the commentary to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;add_comment&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.add_warning"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.add_warning">[docs]</a>    <span class="k">def</span> <span class="nf">add_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warning</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Add a warning to the out stream (in case of file generation)</span>
<span class="sd">        </span>
<span class="sd">        :param warning str: the warning to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;add_warning&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">add_warning</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.finish"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">required</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Add a final instruction in the out file (in case of file generation)</span>
<span class="sd">        </span>
<span class="sd">        :param required bool: Do nothing if required is False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;finish&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s2">&quot;clean all the path&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="n">required</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.set_python_libdirs"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_python_libdirs">[docs]</a>    <span class="k">def</span> <span class="nf">set_python_libdirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set some generic variables for python library paths&quot;&quot;&quot;</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PYTHON_VERSION&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;PYTHON_LIBDIR0&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;python&#39;</span> <span class="o">+</span> <span class="n">ver</span><span class="p">,</span>
                                                <span class="s1">&#39;site-packages&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;PYTHON_LIBDIR1&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;lib64&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;python&#39;</span> <span class="o">+</span> <span class="n">ver</span><span class="p">,</span>
                                                <span class="s1">&#39;site-packages&#39;</span><span class="p">))</span>
          
        <span class="bp">self</span><span class="o">.</span><span class="n">python_lib0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PYTHON_LIBDIR0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_lib1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PYTHON_LIBDIR1&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.get_names"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.get_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lProducts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Get the products name to add in SALOME_MODULES environment variable</span>
<span class="sd">        It is the name of the product, except in the case where the is a </span>
<span class="sd">        component name. And it has to be in SALOME_MODULES variable only </span>
<span class="sd">        if the product has the property has_salome_hui = &quot;yes&quot;</span>
<span class="sd">        </span>
<span class="sd">        :param lProducts list: List of products to potentially add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lProdHasGui</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">lProducts</span> <span class="k">if</span> <span class="s1">&#39;properties&#39;</span> <span class="ow">in</span> 
            <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">and</span>
            <span class="s1">&#39;has_salome_gui&#39;</span> <span class="ow">in</span> 
            <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span> <span class="ow">and</span>
            <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
                                           <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">has_salome_gui</span><span class="o">==</span><span class="s1">&#39;yes&#39;</span><span class="p">]</span>
        <span class="n">lProdName</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ProdName</span> <span class="ow">in</span> <span class="n">lProdHasGui</span><span class="p">:</span>
            <span class="n">pi</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ProdName</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;component_name&#39;</span> <span class="ow">in</span> <span class="n">pi</span><span class="p">:</span>
                <span class="n">lProdName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">component_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lProdName</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ProdName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lProdName</span></div>

<div class="viewcode-block" id="SalomeEnviron.set_application_env"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_application_env">[docs]</a>    <span class="k">def</span> <span class="nf">set_application_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the environment defined in the APPLICATION file.</span>
<span class="sd">        </span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># add variable PRODUCT_ROOT_DIR as $workdir in APPLICATION.environ section if not present</span>
        <span class="k">try</span><span class="p">:</span> 
          <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">PRODUCT_ROOT_DIR</span>
        <span class="k">except</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">PRODUCT_ROOT_DIR</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">pyconf</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">pyconf</span><span class="o">.</span><span class="n">DOLLAR</span><span class="p">,</span> <span class="s2">&quot;workdir&quot;</span><span class="p">)</span>
          <span class="n">DBG</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set_application_env add default Config.APPLICATION.environ.PRODUCT_ROOT_DIR&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
          
        <span class="c1"># Set the variables defined in the &quot;environ&quot; section</span>
        <span class="k">if</span> <span class="s1">&#39;environ&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="p">:</span>
            <span class="c1"># we write PRODUCT environment it in order to conform to </span>
            <span class="c1"># parseConfigFile.py</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s2">&quot;PRODUCT environment&quot;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg_environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span> <span class="ow">and</span> <span class="s2">&quot;build&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg_environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">build</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span> <span class="ow">and</span> <span class="s2">&quot;launch&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg_environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">launch</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># If there is an &quot;environ_script&quot; section, load the scripts</span>
        <span class="k">if</span> <span class="s1">&#39;environ_script&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pscript</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ_script</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s2">&quot;script </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pscript</span><span class="p">)</span>
                <span class="n">sname</span> <span class="o">=</span> <span class="n">pscript</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_env_script</span><span class="p">(</span><span class="s2">&quot;APPLICATION_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sname</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">environ_script</span><span class="p">[</span><span class="n">pscript</span><span class="p">],</span>
                                <span class="n">logger</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       </div>

<div class="viewcode-block" id="SalomeEnviron.set_salome_minimal_product_env"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_salome_minimal_product_env">[docs]</a>    <span class="k">def</span> <span class="nf">set_salome_minimal_product_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_info</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the minimal environment for a SALOME product.</span>
<span class="sd">        xxx_ROOT_DIR and xxx_SRC_DIR</span>
<span class="sd">        </span>
<span class="sd">        :param product_info Config: The product description</span>
<span class="sd">        :param logger Logger: The logger instance to display messages        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set root dir</span>
        <span class="n">DBG</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set_salome_minimal_product_env&quot;</span><span class="p">,</span> <span class="n">product_info</span><span class="p">)</span>
        <span class="n">root_dir</span> <span class="o">=</span> <span class="n">product_info</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_ROOT_DIR&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;install_dir&#39;</span> <span class="ow">in</span> <span class="n">product_info</span> <span class="ow">and</span> <span class="n">product_info</span><span class="o">.</span><span class="n">install_dir</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">product_info</span><span class="o">.</span><span class="n">install_dir</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;No install_dir for product </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span>
                              <span class="n">product_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        
        <span class="n">source_in_package</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_property_in_product_cfg</span><span class="p">(</span><span class="n">product_info</span><span class="p">,</span>
                                                           <span class="s2">&quot;sources_in_package&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span> <span class="ow">or</span> <span class="n">source_in_package</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="c1"># set source dir, unless no source dir</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">product_is_fixed</span><span class="p">(</span><span class="n">product_info</span><span class="p">):</span>
                <span class="n">src_dir</span> <span class="o">=</span> <span class="n">product_info</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_SRC_DIR&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="n">src_dir</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">product_info</span><span class="o">.</span><span class="n">source_dir</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">src_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;out_dir_Path&quot;</span><span class="p">,</span>
                                                       <span class="s2">&quot;SOURCES&quot;</span><span class="p">,</span>
                                                       <span class="n">product_info</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="SalomeEnviron.set_salome_generic_product_env"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_salome_generic_product_env">[docs]</a>    <span class="k">def</span> <span class="nf">set_salome_generic_product_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the generic environment for a SALOME product.</span>
<span class="sd">        </span>
<span class="sd">        :param pi Config: The product description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Construct XXX_ROOT_DIR</span>
        <span class="n">env_root_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_ROOT_DIR&quot;</span><span class="p">)</span>
        <span class="n">l_binpath_libpath</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># create additional ROOT_DIR for CPP components</span>
        <span class="k">if</span> <span class="s1">&#39;component_name&#39;</span> <span class="ow">in</span> <span class="n">pi</span><span class="p">:</span>
            <span class="n">compo_name</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">component_name</span>
            <span class="k">if</span> <span class="n">compo_name</span> <span class="o">+</span> <span class="s2">&quot;CPP&quot;</span> <span class="o">==</span> <span class="n">pi</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">compo_root_dir</span> <span class="o">=</span> <span class="n">compo_name</span> <span class="o">+</span> <span class="s2">&quot;_ROOT_DIR&quot;</span>
                <span class="n">envcompo_root_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">TOOLS</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">install_root</span><span class="p">,</span> <span class="n">compo_name</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">compo_root_dir</span> <span class="p">,</span>  <span class="n">envcompo_root_dir</span><span class="p">)</span>
                <span class="n">bin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">envcompo_root_dir</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;salome&#39;</span><span class="p">)</span>
                <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">envcompo_root_dir</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;salome&#39;</span><span class="p">)</span>
                <span class="n">l_binpath_libpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">get_property_in_product_cfg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="s2">&quot;fhs&quot;</span><span class="p">):</span>
            <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">)</span>
            <span class="n">pylib1_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib0</span><span class="p">)</span>
            <span class="n">pylib2_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib1</span><span class="p">)</span>
            <span class="n">bin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;salome&#39;</span><span class="p">)</span>
            <span class="n">pylib1_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib0</span><span class="p">,</span> <span class="s1">&#39;salome&#39;</span><span class="p">)</span>
            <span class="n">pylib2_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib1</span><span class="p">,</span> <span class="s1">&#39;salome&#39;</span><span class="p">)</span>
            <span class="n">bin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;salome&#39;</span><span class="p">)</span>

        <span class="c1"># Construct the paths to prepend to PATH and LD_LIBRARY_PATH and </span>
        <span class="c1"># PYTHONPATH</span>
        <span class="n">l_binpath_libpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span> <span class="ow">in</span> <span class="n">l_binpath_libpath</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">bin_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">architecture</span><span class="o">.</span><span class="n">is_windows</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span>

            <span class="n">l</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span> <span class="n">pylib1_path</span><span class="p">,</span> <span class="n">pylib2_path</span> <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.set_cpp_env"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_cpp_env">[docs]</a>    <span class="k">def</span> <span class="nf">set_cpp_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the generic environment for a SALOME cpp product.</span>
<span class="sd">        </span>
<span class="sd">        :param product_info Config: The product description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Construct XXX_ROOT_DIR</span>
        <span class="n">env_root_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">product_info</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_ROOT_DIR&quot;</span><span class="p">)</span>
        <span class="n">l_binpath_libpath</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Construct the paths to prepend to PATH and LD_LIBRARY_PATH and </span>
        <span class="c1"># PYTHONPATH</span>
        <span class="n">bin_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">)</span>
        <span class="n">lib_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">)</span>
        <span class="n">l_binpath_libpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span> <span class="ow">in</span> <span class="n">l_binpath_libpath</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">bin_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">architecture</span><span class="o">.</span><span class="n">is_windows</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">)</span>

            <span class="n">l</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bin_path</span><span class="p">,</span> <span class="n">lib_path</span><span class="p">,</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib0</span><span class="p">),</span>
                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env_root_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_lib1</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.load_cfg_environment"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.load_cfg_environment">[docs]</a>    <span class="k">def</span> <span class="nf">load_cfg_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg_env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Loads environment defined in cfg_env </span>
<span class="sd">        </span>
<span class="sd">        :param cfg_env Config: A config containing an environment    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Loop on cfg_env values</span>
        <span class="k">for</span> <span class="n">env_def</span> <span class="ow">in</span> <span class="n">cfg_env</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">cfg_env</span><span class="p">[</span><span class="n">env_def</span><span class="p">]</span>
            
            <span class="c1"># if it is env_script, do not do anything (reserved keyword)</span>
            <span class="k">if</span> <span class="n">env_def</span> <span class="o">==</span> <span class="s2">&quot;env_script&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="c1"># if it is a dict, do not do anything</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">pyconf</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># if it is a list, loop on its values</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">pyconf</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
                <span class="c1"># transform into list of strings</span>
                <span class="n">l_val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">l_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">l_val</span>

            <span class="c1"># &quot;_&quot; means that the value must be prepended</span>
            <span class="k">if</span> <span class="n">env_def</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                <span class="c1"># separator exception for PV_PLUGIN_PATH</span>
                <span class="k">if</span> <span class="n">env_def</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;PV_PLUGIN_PATH&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">env_def</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">val</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">env_def</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">env_def</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
                <span class="c1"># separator exception for PV_PLUGIN_PATH</span>
                <span class="k">if</span> <span class="n">env_def</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PV_PLUGIN_PATH&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env_def</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env_def</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">env_def</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="SalomeEnviron.set_a_product"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_a_product">[docs]</a>    <span class="k">def</span> <span class="nf">set_a_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the environment of a product. </span>
<span class="sd">        </span>
<span class="sd">        :param product str: The product name</span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get the informations corresponding to the product</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">get_product_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span>

        <span class="c1"># skip mesa products (if any) at run time, </span>
        <span class="c1"># unless use_mesa property was activated</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;APPLICATION&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>  <span class="ow">and</span>
                    <span class="s2">&quot;properties&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span>  <span class="ow">and</span>
                    <span class="s2">&quot;use_mesa&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">properties</span>  <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">use_mesa</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;properties&quot;</span> <span class="ow">in</span> <span class="n">pi</span> <span class="ow">and</span>
                    <span class="s2">&quot;is_mesa&quot;</span> <span class="ow">in</span> <span class="n">pi</span><span class="o">.</span><span class="n">properties</span>  <span class="ow">and</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">is_mesa</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Skip mesa product </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">pi</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="k">return</span>
               
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span><span class="p">:</span>
            <span class="n">pi</span><span class="o">.</span><span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;out_dir_Path&quot;</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span><span class="p">,</span>
                                          <span class="n">pi</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Setting environment for </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">product</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s1">&#39;setting environ for &#39;</span> <span class="o">+</span> <span class="n">product</span><span class="p">)</span>
            
        <span class="c1"># Do not define environment if the product is native</span>
        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">product_is_native</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">product_has_env_script</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_env_script</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">native</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span>
               
        <span class="c1"># Set an additional environment for SALOME products</span>
        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">product_is_salome</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
            <span class="c1"># set environment using definition of the product</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_salome_minimal_product_env</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_salome_generic_product_env</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">product_is_cpp</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
            <span class="c1"># set a specific environment for cpp modules</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_salome_minimal_product_env</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cpp_env</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">product_is_generated</span><span class="p">(</span><span class="n">pi</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;component_name&quot;</span> <span class="ow">in</span> <span class="n">pi</span><span class="p">:</span>
                    <span class="c1"># hack the source and install directories in order to point  </span>
                    <span class="c1"># on the generated product source install directories</span>
                    <span class="n">install_dir_save</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">install_dir</span>
                    <span class="n">source_dir_save</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">source_dir</span>
                    <span class="n">name_save</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                                                  <span class="s2">&quot;INSTALL&quot;</span><span class="p">,</span>
                                                  <span class="n">pi</span><span class="o">.</span><span class="n">component_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span><span class="p">:</span>
                        <span class="n">pi</span><span class="o">.</span><span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;out_dir_Path&quot;</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">for_package</span><span class="p">,</span>
                                                      <span class="n">pi</span><span class="o">.</span><span class="n">component_name</span><span class="p">)</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span>
                                                  <span class="s2">&quot;GENERATED&quot;</span><span class="p">,</span>
                                                  <span class="n">pi</span><span class="o">.</span><span class="n">component_name</span><span class="p">)</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">pi</span><span class="o">.</span><span class="n">component_name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_salome_minimal_product_env</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_salome_generic_product_env</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
                    
                    <span class="c1"># Put original values</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">install_dir</span> <span class="o">=</span> <span class="n">install_dir_save</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">source_dir</span> <span class="o">=</span> <span class="n">source_dir_save</span>
                    <span class="n">pi</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_save</span>
        
        <span class="c1"># Put the environment define in the configuration of the product</span>
        <span class="k">if</span> <span class="s2">&quot;environ&quot;</span> <span class="ow">in</span> <span class="n">pi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg_environment</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span> <span class="ow">and</span> <span class="s2">&quot;build&quot;</span> <span class="ow">in</span> <span class="n">pi</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg_environment</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">build</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forBuild</span> <span class="ow">and</span> <span class="s2">&quot;launch&quot;</span> <span class="ow">in</span> <span class="n">pi</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_cfg_environment</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">launch</span><span class="p">)</span>
            <span class="c1"># if product_info defines a env_scripts, load it</span>
            <span class="k">if</span> <span class="s1">&#39;env_script&#39;</span> <span class="ow">in</span> <span class="n">pi</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_env_script</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></div>

        
            

<div class="viewcode-block" id="SalomeEnviron.run_env_script"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.run_env_script">[docs]</a>    <span class="k">def</span> <span class="nf">run_env_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_info</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">native</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Runs an environment script. </span>
<span class="sd">        </span>
<span class="sd">        :param product_info Config: The product description</span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        :param native Boolean: if True load set_native_env instead of set_env</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env_script</span> <span class="o">=</span> <span class="n">product_info</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">env_script</span>
        <span class="c1"># Check that the script exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">env_script</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">src</span><span class="o">.</span><span class="n">SatException</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Environment script not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> 
                                   <span class="n">env_script</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  ** load </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">env_script</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c1"># import the script and run the set_env function</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">imp</span>
            <span class="n">pyproduct</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="n">product_info</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_env_script&quot;</span><span class="p">,</span>
                                        <span class="n">env_script</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">native</span><span class="p">:</span>
                <span class="n">pyproduct</span><span class="o">.</span><span class="n">set_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                  <span class="n">product_info</span><span class="o">.</span><span class="n">install_dir</span><span class="p">,</span>
                                  <span class="n">product_info</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;set_nativ_env&quot;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">pyproduct</span><span class="p">):</span>
                    <span class="n">pyproduct</span><span class="o">.</span><span class="n">set_nativ_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">__</span><span class="p">,</span> <span class="n">exceptionValue</span><span class="p">,</span> <span class="n">exceptionTraceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">exceptionValue</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_tb</span><span class="p">(</span><span class="n">exceptionTraceback</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span></div>

<div class="viewcode-block" id="SalomeEnviron.run_simple_env_script"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.run_simple_env_script">[docs]</a>    <span class="k">def</span> <span class="nf">run_simple_env_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script_path</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Runs an environment script. Same as run_env_script, but with a </span>
<span class="sd">        script path as parameter.</span>
<span class="sd">        </span>
<span class="sd">        :param script_path str: a path to an environment script</span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_simple_env_script</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Check that the script exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">script_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">src</span><span class="o">.</span><span class="n">SatException</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Environment script not found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> 
                                   <span class="n">script_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="ow">and</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  ** load </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">script_path</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">script_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">script_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">script_basename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">):</span>
            <span class="n">script_basename</span> <span class="o">=</span> <span class="n">script_basename</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)]</span>

        <span class="c1"># import the script and run the set_env function</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">imp</span>
            <span class="n">pyproduct</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="n">script_basename</span> <span class="o">+</span> <span class="s2">&quot;_env_script&quot;</span><span class="p">,</span>
                                        <span class="n">script_path</span><span class="p">)</span>
            <span class="n">pyproduct</span><span class="o">.</span><span class="n">load_env</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">__</span><span class="p">,</span> <span class="n">exceptionValue</span><span class="p">,</span> <span class="n">exceptionTraceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">exceptionValue</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_tb</span><span class="p">(</span><span class="n">exceptionTraceback</span><span class="p">)</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span></div>

<div class="viewcode-block" id="SalomeEnviron.set_products"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_products">[docs]</a>    <span class="k">def</span> <span class="nf">set_products</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">src_root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the environment for all the products. </span>
<span class="sd">        </span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        :param src_root src: the application working directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="s1">&#39;setting environ for all products&#39;</span><span class="p">)</span>

        <span class="c1"># Make sure that the python lib dirs are set after python</span>
        <span class="k">if</span> <span class="s2">&quot;Python&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_a_product</span><span class="p">(</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_python_libdirs</span><span class="p">()</span>

        <span class="c1"># The loop on the products</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;Python&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_a_product</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>
 
<div class="viewcode-block" id="SalomeEnviron.set_full_environ"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.SalomeEnviron.set_full_environ">[docs]</a>    <span class="k">def</span> <span class="nf">set_full_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">env_info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Sets the full environment for products </span>
<span class="sd">        specified in env_info dictionary. </span>
<span class="sd">        </span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        :param env_info list: the list of products</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DBG</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;set_full_environ for&quot;</span><span class="p">,</span> <span class="n">env_info</span><span class="p">)</span>
        <span class="c1"># DBG.write(&quot;set_full_environ config&quot;, self.cfg.APPLICATION.environ, True)</span>
        <span class="c1"># set product environ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_application_env</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_python_libdirs</span><span class="p">()</span>

        <span class="c1"># set products</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">env_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_a_product</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="FileEnvWriter"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.FileEnvWriter">[docs]</a><span class="k">class</span> <span class="nc">FileEnvWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Class to dump the environment to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">src_root</span><span class="p">,</span> <span class="n">env_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Initialization.</span>

<span class="sd">        :param cfg Config: the global config</span>
<span class="sd">        :param logger Logger: The logger instance to display messages</span>
<span class="sd">        :param out_dir str: The directory path where t put the output files</span>
<span class="sd">        :param src_root str: The application working directory</span>
<span class="sd">        :param env_info str: The list of products to add in the files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span> <span class="o">=</span> <span class="n">out_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src_root</span><span class="o">=</span> <span class="n">src_root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span> <span class="o">=</span> <span class="n">env_info</span>

<div class="viewcode-block" id="FileEnvWriter.write_env_file"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.FileEnvWriter.write_env_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_env_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">forBuild</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span> <span class="n">for_package</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Create an environment file.</span>
<span class="sd">        </span>
<span class="sd">        :param filename str: the file path</span>
<span class="sd">        :param forBuild bool: if true, the build environment</span>
<span class="sd">        :param shell str: the type of file wanted (.sh, .bat)</span>
<span class="sd">        :return: The path to the generated file</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Create environment file </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> 
                              <span class="n">src</span><span class="o">.</span><span class="n">printcolors</span><span class="o">.</span><span class="n">printcLabel</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># create then env object</span>
        <span class="n">env_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">fileEnviron</span><span class="o">.</span><span class="n">get_file_environ</span><span class="p">(</span><span class="n">env_file</span><span class="p">,</span>
                                               <span class="n">shell</span><span class="p">,</span>
                                               <span class="p">{})</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">SalomeEnviron</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">forBuild</span><span class="p">,</span> <span class="n">for_package</span><span class="o">=</span><span class="n">for_package</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span>

        <span class="c1"># Set the environment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_full_environ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># set env from the APPLICATION</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_application_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            
            <span class="c1"># The list of products to launch</span>
            <span class="n">lProductsName</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="s2">&quot;SALOME_MODULES&quot;</span><span class="p">,</span>    <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lProductsName</span><span class="p">))</span>
            
            <span class="c1"># set the products</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_products</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                            <span class="n">src_root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">src_root</span><span class="p">)</span>

        <span class="c1"># add cleanup and close</span>
        <span class="n">env</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">env_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">env_file</span><span class="o">.</span><span class="n">name</span></div>
   
<div class="viewcode-block" id="FileEnvWriter.write_cfgForPy_file"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.FileEnvWriter.write_cfgForPy_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_cfgForPy_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">filename</span><span class="p">,</span>
                            <span class="n">additional_env</span> <span class="o">=</span> <span class="p">{},</span>
                            <span class="n">for_package</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">with_commercial</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Append to current opened aFile a cfgForPy </span>
<span class="sd">        environment (SALOME python launcher).</span>
<span class="sd">           </span>
<span class="sd">        :param filename str: the file path</span>
<span class="sd">        :param additional_env dict: a dictionary of additional variables </span>
<span class="sd">                                    to add to the environment</span>
<span class="sd">        :param for_package str: If not None, produce a relative environment </span>
<span class="sd">                                designed for a package. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Create configuration file </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> 
                              <span class="n">src</span><span class="o">.</span><span class="n">printcolors</span><span class="o">.</span><span class="n">printcLabel</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># create then env object</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">fileEnviron</span><span class="o">.</span><span class="n">get_file_environ</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> 
                                               <span class="s2">&quot;cfgForPy&quot;</span><span class="p">,</span> 
                                               <span class="p">{})</span>
        <span class="c1"># environment for launch</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">SalomeEnviron</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                            <span class="n">tmp</span><span class="p">,</span>
                            <span class="n">forBuild</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">for_package</span><span class="o">=</span><span class="n">for_package</span><span class="p">,</span>
                            <span class="n">enable_simple_env_script</span> <span class="o">=</span> <span class="n">with_commercial</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">silent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">silent</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_full_environ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># set env from PRODUCT</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_application_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

            <span class="c1"># The list of products to launch</span>
            <span class="n">lProductsName</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">APPLICATION</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="s2">&quot;SALOME_MODULES&quot;</span><span class="p">,</span>    <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lProductsName</span><span class="p">))</span>

            <span class="c1"># set the products</span>
            <span class="n">env</span><span class="o">.</span><span class="n">set_products</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                            <span class="n">src_root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">src_root</span><span class="p">)</span>

        <span class="c1"># Add the additional environment if it is not empty</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">additional_env</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">additional_env</span><span class="p">:</span>
                <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">additional_env</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span>

        <span class="c1"># add cleanup and close</span>
        <span class="n">env</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Shell"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.Shell">[docs]</a><span class="k">class</span> <span class="nc">Shell</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Definition of a Shell.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">extension</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        Initialization.</span>

<span class="sd">        :param name str: the shell name</span>
<span class="sd">        :param extension str: the shell extension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span></div>

<div class="viewcode-block" id="load_environment"><a class="viewcode-back" href="../../commands/apidoc/src.html#src.environment.load_environment">[docs]</a><span class="k">def</span> <span class="nf">load_environment</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Loads the environment (used to run the tests, for example).</span>
<span class="sd">    </span>
<span class="sd">    :param config Config: the global config</span>
<span class="sd">    :param build bool: build environement if True</span>
<span class="sd">    :param logger Logger: The logger instance to display messages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">environ</span> <span class="o">=</span> <span class="n">SalomeEnviron</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">Environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">),</span> <span class="n">build</span><span class="p">)</span>
    <span class="n">environ</span><span class="o">.</span><span class="n">set_application_env</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">environ</span><span class="o">.</span><span class="n">set_products</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">environ</span><span class="o">.</span><span class="n">finish</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/sat_v5.0.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, CEA.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>