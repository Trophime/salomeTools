<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Command environ &#8212; salomeTools 5.0.0dev documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="salomeTools 5.0.0dev documentation" href="../index.html" />
    <link rel="next" title="Command clean" href="clean.html" />
    <link rel="prev" title="Command log" href="log.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="command-environ">
<h1>Command environ<a class="headerlink" href="#command-environ" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <strong>environ</strong> command generates the environment files used
to run and compile your application (as <a class="reference external" href="http://www.salome-platform.org">SALOME</a> is an example).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>these files are <strong>not</strong> required,
salomeTool set the environment himself, when compiling.
And so does the salome launcher.</p>
<p class="last">These files are useful when someone wants to check the environment.
They could be used in debug mode to set the environment for <em>gdb</em>.</p>
</div>
<p>The configuration part at the end of this page explains how
to specify the environment used by sat (at build or run time),
and saved in some files by <em>sat environ</em> command.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Create the shell environment files of the application:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sat</span> <span class="n">environ</span> <span class="o">&lt;</span><span class="n">application</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Create the environment files of the application for a given shell.
Options are bash, bat (for windows) and cfg (the configuration format used by <a class="reference external" href="http://www.salome-platform.org">SALOME</a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sat</span> <span class="n">environ</span> <span class="o">&lt;</span><span class="n">application</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">shell</span> <span class="p">[</span><span class="n">bash</span><span class="o">|</span><span class="n">cfg</span><span class="o">|</span><span class="nb">all</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">Use a different prefix for the files (default is 'env'):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># This will create file &lt;prefix&gt;_launch.sh, &lt;prefix&gt;_build.sh</span>
sat environ &lt;application&gt; --prefix &lt;prefix&gt;
</pre></div>
</div>
</li>
<li><p class="first">Use a different target directory for the files:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># This will create file env_launch.sh, env_build.sh</span>
<span class="c1"># in the directory corresponding to &lt;path&gt;</span>
sat environ &lt;application&gt; --target &lt;path&gt;
</pre></div>
</div>
</li>
<li><p class="first">Generate the environment files only with the given products:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># This will create the environment files only for the given products</span>
<span class="c1"># and their prerequisites.</span>
<span class="c1"># It is useful when you want to visualise which environment uses</span>
<span class="c1"># sat to compile a given product.</span>
sat environ &lt;application&gt; --product &lt;product1&gt;,&lt;product2&gt;, ...
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The specification of the environment can be done through several mechanisms.</p>
<ol class="arabic simple">
<li>For salome products (the products with the property <code class="docutils literal"><span class="pre">is_SALOME_module</span></code> as <code class="docutils literal"><span class="pre">yes</span></code>) the environment is set automatically by sat, in respect with <a class="reference external" href="http://www.salome-platform.org">SALOME</a> requirements.</li>
<li>For other products, the environment is set with the use of the environ section within the pyconf file of the product. The user has two possibilities, either set directly the environment within the section, or specify a python script which wil be used to set the environment programmatically.</li>
</ol>
<p>Within the section, the user can define environment variables. He can also modify PATH variables, by appending or prepending directories.
In the following example, we prepend <em>&lt;install_dir&gt;/lib</em> to <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code> (note the <em>left first</em> underscore), append <em>&lt;install_dir&gt;/lib</em> to <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> (note the <em>right last</em> underscore), and set <code class="docutils literal"><span class="pre">LAPACK_ROOT_DIR</span></code> to <em>&lt;install_dir&gt;</em>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>environ :
<span class="o">{</span>
  _LD_LIBRARY_PATH : <span class="nv">$install_dir</span> + <span class="nv">$VARS</span>.sep + <span class="s2">&quot;lib&quot;</span>
  PYTHONPATH_ : <span class="nv">$install_dir</span> + <span class="nv">$VARS</span>.sep + <span class="s2">&quot;lib&quot;</span>
  LAPACK_ROOT_DIR : <span class="nv">$install_dir</span>
<span class="o">}</span>
</pre></div>
</div>
<p>It is possible to distinguish the build environment from the launch environment: use a subsection called <em>build</em> or <em>launch</em>. In the example below, <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code> and <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> are only modified at run time, not at compile time:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>environ :
<span class="o">{</span>
  build :
  <span class="o">{</span>
    LAPACK_ROOT_DIR : <span class="nv">$install_dir</span>
  <span class="o">}</span>
  launch :
  <span class="o">{</span>
    LAPACK_ROOT_DIR : <span class="nv">$install_dir</span>
    _LD_LIBRARY_PATH : <span class="nv">$install_dir</span> + <span class="nv">$VARS</span>.sep + <span class="s2">&quot;lib&quot;</span>
    PYTHONPATH_ : <span class="nv">$install_dir</span> + <span class="nv">$VARS</span>.sep + <span class="s2">&quot;lib&quot;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>The last possibility is to set the environment with a python script. The script should be provided in the <em>products/env_scripts</em> directory of the sat project, and its name is specified in the environment section with the key <code class="docutils literal"><span class="pre">environ.env_script</span></code>:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">environ</span> <span class="p">:</span>
<span class="p">{</span>
  <span class="n">env_script</span> <span class="p">:</span> <span class="s1">&#39;lapack.py&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please note that the two modes are complementary and are both taken into account.
Most of the time, the first mode is sufficient.</p>
<p>The second mode can be used when the environment has to be set programmatically.
The developer implements a handle (as a python method)
which is called by sat to set the environment.
Here is an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#-*- coding:utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="k">def</span> <span class="nf">set_env</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">prereq_dir</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
    <span class="n">env</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;TRUST_ROOT_DIR&quot;</span><span class="p">,</span><span class="n">prereq_dir</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prereq_dir</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prereq_dir</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prereq_dir</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>SalomeTools defines four handles:</p>
<ul class="simple">
<li><strong>set_env(env, prereq_dir, version)</strong> : used at build and run time.</li>
<li><strong>set_env_launch(env, prereq_dir, version)</strong> : used only at run time (if defined!)</li>
<li><strong>set_env_build(env, prereq_dir, version)</strong> : used only at build time (if defined!)</li>
<li><strong>set_native_env(env)</strong> : used only for native products, at build and run time.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/sat_v5.0.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Command environ</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="log.html" title="previous chapter">Command log</a></li>
      <li>Next: <a href="clean.html" title="next chapter">Command clean</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/commands/environ.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, CEA.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.9</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/commands/environ.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>